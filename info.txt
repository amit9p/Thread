with definitions_choices as (
    select * from EDA_CDO_SURVEY_DEV.CDOSURVEY_T.stg_surv_ques_cho
),
import_choices as (
    select * from EDA_CDO_SURVEY_DEV.CDO_SURVEY_T.stg_impt_id_map
    qualify row_number() over (partition by surv_id , ques_id , cho_id order by load_dt desc) = 1
)

select 
    COALESCE(D.CHO_SYSKEY, '-1') as CHO_SYSKEY, -- Use D.CHO_SYSKEY if available
    COALESCE(I.QUES_SYS_KEY, D.QUES_SYS_KEY) as QUES_SYS_KEY,
    COALESCE(I.SURV_ID, D.SURV_ID) as SURV_ID,
    COALESCE(I.CHO_ID, D.CHO_ID) as CHO_ID,
    COALESCE(I.CHO_DSPL_TXT, D.CHO_TXT) as CHO_DSPL_TXT
FROM import_choices I
LEFT JOIN definitions_choices D using (SURV_ID , QUES_ID, CHO_ID)
